From c779b4dc43bd201b41868fb9da6b9eae349e852b Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=D0=92=D0=B0=D1=88=D0=B5=20=D0=98=D0=BC=D1=8F?=
 <zakievbulat@gmail.com>
Date: Wed, 27 Aug 2025 17:56:11 +0300
Subject: [PATCH] feat(backend): doc-first + spec.hints + auto-run; prompt
 logging; http safety; env example

---
 backend/index.js | 12 ++++++------
 1 file changed, 6 insertions(+), 6 deletions(-)

diff --git a/backend/index.js b/backend/index.js
index 97c6690..655a0fc 100644
--- a/backend/index.js
+++ b/backend/index.js
@@ -334,8 +334,8 @@ app.post('/api/agent/chat', async function(req,res){
         let url = args.url;
         if (!url && args.path) {
           const base = pickBaseForPath(env, args.baseVar);
-          const p = String(args.path).replace(/^//,'');
-          url = String(base || '').replace(//$/,'') + '/' + p;
+          const p = String(args.path).replace(/^\//,'');
+          url = String(base || '').replace(/\/$/,'') + '/' + p;
         }
         if (!url) throw new Error('No url/path');
         const headers = args.headers || {};
@@ -369,8 +369,8 @@ app.post('/api/agent/chat', async function(req,res){
           let url = reqSpec.url;
           if (!url && reqSpec.path) {
             const base = pickBaseForPath(env, reqSpec.baseVar);
-            const p = String(reqSpec.path).replace(/^//,'');
-            url = String(base || '').replace(//$/,'') + '/' + p;
+            const p = String(reqSpec.path).replace(/^\//,'');
+            url = String(base || '').replace(/\/$/,'') + '/' + p;
           }
           if (!url) {
             steps.push({ tool:'script.run(auto)', ok:false, error:'No url for script.run(auto)' });
@@ -401,8 +401,8 @@ app.post('/api/agent/chat', async function(req,res){
         let url = reqSpec.url;
         if (!url && reqSpec.path) {
           const base = pickBaseForPath(env, reqSpec.baseVar);
-          const p = String(reqSpec.path).replace(/^//,'');
-          url = String(base || '').replace(//$/,'') + '/' + p;
+          const p = String(reqSpec.path).replace(/^\//,'');
+          url = String(base || '').replace(/\/$/,'') + '/' + p;
         }
         if (!url) throw new Error('No url for script.run');
         const headers = reqSpec.headers || {};
-- 
2.43.0

